#!/usr/bin/env node

var minimist = require('minimist');
var options = minimist(process.argv, {
  boolean: [
    'no-color',
    'json',
    'dry-run',
    'ignore-stars',
    'ignore-pegged',
    'check'
  ],
  alias: {
    'dry-run': 'n'
  },
  default: {
    'no-color': false,
    json: false,
    'dry-run': false,
    'ignore-stars': false,
    'ignore-pegged': false,
    check: false
  }
});
if (options.check) { options['dry-run'] = true; }
var salita = require('../');

salita(process.cwd(), options, function (counts) {
  counts.then(function (counts) {
    var sums = counts.reduce(function (sums, category) { return [sums[0] + category[0], sums[1] + category[1]]; }, [0, 0]);
    var total = sums[0];
    var changed = sums[1];
    if (!options.json) {
      console.error('\n' + changed + ' updated out of ' + total + ' total dependencies.');
    }
    if (options.check) { process.exit(changed); }
  });
});
